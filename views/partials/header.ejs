<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= title %> · CRM Gemavip</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="/assets/images/gemavip-logo.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/assets/styles/gemavip.css" />
    <% if (typeof extraStyles !== 'undefined' && Array.isArray(extraStyles)) { %>
      <% extraStyles.forEach((href) => { %>
        <% if (href) { %>
          <link rel="stylesheet" href="<%= href %>" />
        <% } %>
      <% }) %>
    <% } %>
  </head>
  <body>
    <% const hv = (typeof headerVariant !== 'undefined' && headerVariant) ? headerVariant : 'default'; %>
    <div class="topbar <%= hv === 'login' ? 'topbar--login' : '' %>">
      <div class="topbar-inner container" style="padding-top: 14px; padding-bottom: 14px;">
        <% if (hv === 'login') { %>
          <div class="login-topbar">
            <img
              class="brand-logo"
              src="/assets/images/logo-gemavip.jpeg"
              alt="Gemavip"
              onerror="this.onerror=null; this.src='/assets/images/gemavip-logo.svg';"
            />
            <div class="login-topbar-title">CRM COMERCIAL GEMAVIP</div>
          </div>
        <% } else if (hv === 'public') { %>
          <a class="brand" href="/registro-visitas" style="text-decoration:none;">
            <img
              class="brand-logo"
              src="/assets/images/logo-gemavip.jpeg"
              alt="Gemavip"
              onerror="this.onerror=null; this.src='/assets/images/gemavip-logo.svg';"
            />
            <span class="brand-title">REGISTRO VISITAS</span>
          </a>
          <nav class="nav" aria-label="Principal">
            <a href="/registro-visitas">Formulario</a>
            <a href="/login">Acceso CRM</a>
          </nav>
          <div class="userbox"></div>
        <% } else { %>
          <a class="brand" href="/dashboard" style="text-decoration:none;">
            <img
              class="brand-logo"
              src="/assets/images/logo-gemavip.jpeg"
              alt="Gemavip"
              onerror="this.onerror=null; this.src='/assets/images/gemavip-logo.svg';"
            />
            <span class="brand-title">HOME</span>
          </a>
          <nav class="nav" aria-label="Principal">
            <% if (user) { %>
              <% (navLinks || []).forEach((l) => { %>
                <a href="<%= l.href %>"><%= l.label %></a>
              <% }) %>
            <% } %>
          </nav>
          <div class="userbox" style="display: flex; align-items: center; gap: 12px;">
            <% if (user && (roleNavLinks || []).some(function(l){ return l.href === '/notificaciones'; })) { %>
              <a href="/notificaciones" class="gv-notif-link" title="Solicitudes de asignación" aria-label="Solicitudes pendientes: <%= typeof notificacionesPendientes === 'number' ? notificacionesPendientes : 0 %>">
                <!-- Icono grupo de personas (solicitudes de asignación de comerciales) -->
                <svg class="gv-notif-icon gv-notif-icon--asignaciones" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <% if (typeof notificacionesPendientes === 'number' && notificacionesPendientes > 0) { %>
                  <span class="gv-notif-badge"><%= notificacionesPendientes > 99 ? '99+' : notificacionesPendientes %></span>
                <% } %>
              </a>
              <!-- Icono sobre/mensajes para futuro CRUD de notificaciones: usar <img src="/assets/images/icon-notif-mensajes.svg" alt="" class="gv-notif-icon gv-notif-icon--mensajes" /> -->
            <% } %>
            <% if (user) { %>
              <details class="user-menu">
                <summary class="user-summary">
                  <span class="user-name"><%= user.nombre || user.email %></span>
                  <span class="user-role"><%= (user.roles || []).join(', ') || 'Usuario' %></span>
                </summary>
                <div class="user-dropdown">
                  <div class="user-dropdown-hd">
                    <div style="font-weight:800; color: var(--gv-ink);"><%= user.nombre || 'Usuario' %></div>
                    <div style="font-size:12px; color: var(--gv-muted);"><%= user.email %></div>
                  </div>
                  <div class="user-links">
                    <a href="/cuenta/cambiar-contrasena">Cambiar contraseña</a>
                    <% if ((roleNavLinks || []).length === 0) { %>
                      <div style="padding: 10px 10px; color: var(--gv-muted); font-weight: 700; font-size: 12px;">
                        Sin accesos adicionales.
                      </div>
                    <% } else { %>
                      <% (roleNavLinks || []).forEach((l) => { %>
                        <a href="<%= l.href %>"><%= l.label %></a>
                      <% }) %>
                    <% } %>
                  </div>
                  <form method="post" action="/logout" style="margin:0; padding: 10px;">
                    <button class="btn secondary" type="submit" style="width:100%; justify-content:center;">Salir</button>
                  </form>
                </div>
              </details>
            <% } else { %>
              <a class="btn secondary" href="/login">Entrar</a>
            <% } %>
          </div>
        <% } %>
      </div>
    </div>
    <main class="container">

