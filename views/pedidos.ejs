<%- include('partials/header', { title: 'Pedidos' }) %>

<section class="card">
  <div class="card-hd">
    <h1 class="card-title">Pedidos</h1>
    <p class="card-subtitle">
      Año <strong><%= selectedYear ?? new Date().getFullYear() %></strong> · <%= items.length %> pedidos (vista ligera).
    </p>
  </div>
  <div class="card-bd">
    <form method="get" action="/pedidos" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin: 0 0 12px 0;">
      <label for="year" style="font-weight:700; color: var(--gv-ink);">Año</label>
      <select id="year" name="year" class="gv-client-picker__q" style="width:auto; min-width: 140px;">
        <% (years || []).forEach((y) => { %>
          <option value="<%= y %>" <%= Number(selectedYear) === Number(y) ? 'selected' : '' %>><%= y %></option>
        <% }) %>
      </select>
      <label for="marca" style="font-weight:700; color: var(--gv-ink);">Marca</label>
      <select id="marca" name="marca" class="gv-client-picker__q" style="width:auto; min-width: 220px;">
        <option value="" <%= !selectedMarcaId ? 'selected' : '' %>>Todas</option>
        <% (marcas || []).forEach((m) => { %>
          <option value="<%= m.id %>" <%= Number(selectedMarcaId) === Number(m.id) ? 'selected' : '' %>><%= m.nombre ?? m.Nombre ?? m.marca ?? m.Marca ?? m.id %></option>
        <% }) %>
      </select>
      <button class="btn secondary" type="submit">Ver</button>
      <a class="btn secondary" href="/pedidos">Año actual</a>
    </form>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>NumPedido</th>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Comercial</th>
            <th>Total</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <% items.forEach((p) => { %>
            <tr>
              <td><%= p.Id ?? p.id %></td>
              <td><%= p.NumPedido ?? p.Numero_Pedido ?? '' %></td>
              <td><%= (p.FechaPedido ?? p.Fecha ?? '').toString().slice(0,10) %></td>
              <td><%= p.Id_Cliente ?? p.Cliente_id ?? p.ClienteId ?? '' %></td>
              <td><%= p.Id_Cial ?? p.ComercialId ?? '' %></td>
              <td><%= p.TotalPedido ?? p.Total ?? '' %></td>
              <td><%= p.EstadoPedido ?? p.Estado ?? '' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</section>

<%- include('partials/footer') %>

