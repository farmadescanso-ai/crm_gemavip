<%- include('partials/header', { title: 'Ficha de artículo' }) %>
<%
  const artId = item.art_id ?? item.Id ?? item.id;
  const artNombre = item.art_nombre ?? item.Nombre ?? '';
  const artSku = item.art_sku ?? item.SKU ?? '';
  const artPresentacion = item.art_presentacion ?? item.Presentacion ?? '';
  const artUnidadesCaja = item.art_unidades_caja ?? item.Unidades_Caja ?? '';
  const artLargoCaja = item.art_largo_caja ?? item.Largo_Caja ?? '';
  const artAltoCaja = item.art_alto_caja ?? item.Alto_Caja ?? '';
  const artAnchoCaja = item.art_ancho_caja ?? item.Ancho_Caja ?? '';
  const artPesoKg = item.art_peso_kg ?? item.PesoKg ?? '';
  const artCajasPalet = item.art_cajas_palet ?? item.Cajas_Palet ?? '';
  const artPvl = item.art_pvl ?? item.PVL ?? '';
  const artIva = item.art_iva ?? item.IVA ?? '';
  const artEan13 = item.art_ean13 ?? item.EAN13 ?? '';
  const artImagen = item.art_imagen ?? item.Imagen ?? '';
  const artActivo = (item.art_activo ?? item.Activo ?? 1);
  const marcaNombre = item.MarcaNombre || item.Marca || item.art_mar_id || '—';
%>
<section class="card">
  <div class="card-hd">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap: 12px; flex-wrap:wrap;">
      <div>
        <h1 class="card-title">Artículo <%= artId %></h1>
        <p class="card-subtitle"><%= artNombre %></p>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn secondary" href="/articulos">Volver</a>
        <% if (admin) { %>
          <a class="btn secondary" href="/articulos/<%= artId %>/edit">Editar</a>
        <% } %>
      </div>
    </div>
  </div>
  <div class="card-bd">
    <% const imgUrl = String(artImagen || '').trim(); %>
    <div class="gv-article-ficha">
      <div class="gv-article-ficha__main">
        <div class="grid gv-article-ficha__grid" style="gap: 10px;">
          <div><strong>SKU:</strong> <%= artSku %></div>
          <div><strong>Nombre:</strong> <%= artNombre %></div>
          <div><strong>Presentación:</strong> <%= artPresentacion %></div>
          <div><strong>Unidades caja:</strong> <%= artUnidadesCaja %></div>
          <div><strong>Largo caja (cm):</strong> <%= artLargoCaja !== '' ? artLargoCaja : '—' %></div>
          <div><strong>Alto caja (cm):</strong> <%= artAltoCaja !== '' ? artAltoCaja : '—' %></div>
          <div><strong>Ancho caja (cm):</strong> <%= artAnchoCaja !== '' ? artAnchoCaja : '—' %></div>
          <div><strong>Peso (kg):</strong> <%= artPesoKg !== '' ? artPesoKg : '—' %></div>
          <div><strong>Cajas por palet:</strong> <%= artCajasPalet !== '' ? artCajasPalet : '—' %></div>
          <div><strong>PVL:</strong> <%= artPvl %></div>
          <div><strong>IVA:</strong> <%= artIva %></div>
          <div><strong>EAN13:</strong> <%= artEan13 || '—' %></div>
          <div><strong>Marca:</strong> <%= marcaNombre %></div>
          <div><strong>Activo:</strong> <%= artActivo ? 'Sí' : 'No' %></div>
        </div>

        <% if (admin) { %>
          <hr style="border:0; border-top:1px solid var(--gv-border); margin: 14px 0;" />
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <form method="post" action="/articulos/<%= artId %>/toggle">
              <input type="hidden" name="Activo" value="<%= artActivo ? 0 : 1 %>" />
              <button class="btn secondary" type="submit">
                <%= artActivo ? 'Desactivar' : 'Activar' %>
              </button>
            </form>
            <form method="post" action="/articulos/<%= artId %>/delete" id="formDeleteArticulo">
              <button class="btn secondary danger" type="submit">Eliminar</button>
            </form>
          </div>
        <% } %>
      </div>

      <% if (imgUrl) { %>
        <aside class="gv-article-ficha__media" aria-label="Imagen del artículo">
          <% if (admin) { %>
          <a class="gv-article-ficha__imgLink" href="<%= imgUrl %>" target="_blank" rel="noopener noreferrer">
            <img
              class="gv-article-ficha__img"
              src="<%= imgUrl %>"
              alt="<%= artNombre || 'Artículo' %>"
              onerror="this.onerror=null; this.style.display='none';"
              loading="lazy"
            />
          </a>
          <div class="gv-article-ficha__mediaFoot">
            <a href="<%= imgUrl %>" target="_blank" rel="noopener noreferrer">Abrir imagen</a>
          </div>
          <% } else { %>
          <div class="gv-article-ficha__imgLink">
            <img
              class="gv-article-ficha__img"
              src="<%= imgUrl %>"
              alt="<%= artNombre || 'Artículo' %>"
              onerror="this.onerror=null; this.style.display='none';"
              loading="lazy"
            />
          </div>
          <% } %>
        </aside>
      <% } %>
    </div>

  </div>
</section>

<% if (admin) { %>
<script>
(function() {
  var form = document.getElementById('formDeleteArticulo');
  if (form) {
    form.addEventListener('submit', function(e) {
      if (!confirm('¿Eliminar este artículo? Esta acción no se puede deshacer.')) {
        e.preventDefault();
      }
    });
  }
})();
</script>
<% } %>

<%- include('partials/footer') %>

